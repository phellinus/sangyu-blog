---
description: ä»‹ç»åŸºäºRedisçš„åˆ†å¸ƒå¼é”çš„ä»‹ç»
sticky: 2
tag:
  - åç«¯
tags:
  - Redis
---

# ğŸš€åŸºäºRedisçš„åˆ†å¸ƒå¼é”çš„ä»‹ç»

> âœï¸ ä½œè€…ï¼šæ¡‘æ¦†  
> ğŸ•“ æ›´æ–°æ—¶é—´ï¼š2025-11-08
> ğŸ§  å…³é”®è¯: åŸºäºRedisçš„åˆ†å¸ƒå¼é”ã€ä»‹ç»ã€å®ç°ã€æ€§èƒ½ä¼˜åŒ–


## ğŸ§© å‰è¨€
>   æœ€è¿‘å†å­¦ä¹ shortlinkçŸ­é“¾æ¥ï¼Œå½“ç”¨æˆ·æ³¨å†Œæ—¶ï¼Œç”±äºç”¨æˆ·åæ˜¯å”¯ä¸€çš„ã€‚
>   é‚£ä¹ˆç”¨æˆ·æ³¨å†Œçš„æ—¶å€™ï¼Œå°±éœ€è¦åˆ¤æ–­ç”¨æˆ·åæ˜¯å¦å·²ç»å­˜åœ¨ï¼Œå¦‚æœå­˜åœ¨äº†ï¼Œé‚£å°±ä¸èƒ½æ³¨å†Œã€‚
>   ä½†æ˜¯ç´§æ¥ç€å°±ä¼šæœ‰ä¸ªé—®é¢˜ï¼Œå¦‚æœæµ·é‡ç”¨æˆ·å¦‚æœè¯´æŸ¥è¯¢çš„ç”¨æˆ·åå­˜åœ¨æˆ–ä¸å­˜åœ¨ï¼Œå…¨éƒ¨è¯·æ±‚æ•°æ®åº“ï¼Œä¼šå°†æ•°æ®åº“ç›´æ¥æ‰“æ»¡ã€‚
>   è¿™é‡Œå°±å…ˆä½¿ç”¨å¸ƒéš†è¿‡æ»¤å™¨æ¥åˆ¤æ–­ç”¨æˆ·åæ˜¯å¦å­˜åœ¨ã€‚
>   å¦‚æœå¸ƒéš†è¿‡æ»¤å™¨åˆ¤æ–­ç”¨æˆ·åä¸å­˜åœ¨ï¼Œé‚£ä¹ˆå°±å¯ä»¥ç»§ç»­æ³¨å†Œï¼Œç„¶åå°†ç”¨æˆ·åæ·»åŠ åˆ°å¸ƒéš†è¿‡æ»¤å™¨ä¸­ã€‚
>   å¦‚æœå¸ƒéš†è¿‡æ»¤å™¨åˆ¤æ–­ç”¨æˆ·åå­˜åœ¨ï¼Œé‚£ä¹ˆå°±ä¸èƒ½æ³¨å†Œã€‚
>   å¦‚ä½•é˜²æ­¢æ¶æ„è¯·æ±‚æ¯«ç§’çº§è§¦å‘å¤§é‡è¯·æ±‚å»ä¸€ä¸ªæœªæ³¨å†Œçš„ç”¨æˆ·åï¼Ÿ

è¿™é‡Œå¯ä»¥ä½¿ç”¨Redisçš„åˆ†å¸ƒå¼é”æ¥é˜²æ­¢æ¶æ„è¯·æ±‚æ¯«ç§’çº§è§¦å‘å¤§é‡è¯·æ±‚å»ä¸€ä¸ªæœªæ³¨å†Œçš„ç”¨æˆ·åã€‚
## äºŒã€ä»£ç ç¤ºä¾‹
ä¸‹é¢æ˜¯é¡¹ç›®ä¸­ `UserServiceImpl` çš„æ ¸å¿ƒé€»è¾‘ï¼Œä½¿ç”¨äº† Redisson å®ç° Redis åˆ†å¸ƒå¼é”ï¼Œé˜²æ­¢å¤šä¸ªç”¨æˆ·åŒæ—¶æ³¨å†Œç›¸åŒç”¨æˆ·åã€‚
```java
RLock lock = redissonClient.getLock(LOCK_USER_REGISTER_KEY + requestParam.getUsername());
try {
    if (lock.tryLock()) {
        int insert = baseMapper.insert(BeanUtil.toBean(requestParam, UserDO.class));
        if (insert < 1) {
            throw new ClientException(UserErrorCodeEnum.USER_SAVE_ERROR);
        }
        userRegisterCachePenetrationBloomFilter.add(requestParam.getUsername());
        return;
    }
    throw new ClientException(UserErrorCodeEnum.USER_NAME_EXIT);
} finally {
    lock.unlock();
}
```

## ä¸‰ã€ğŸ” ä»£ç è®²è§£

### 1. **è·å–åˆ†å¸ƒå¼é”**
```java
RLock lock = redissonClient.getLock("LOCK_USER_REGISTER_KEY" + username);
```
Redisson åº•å±‚ä½¿ç”¨ Redis æ¥å®ç°é”æœºåˆ¶ã€‚æ¯ä¸ªç”¨æˆ·åå¯¹åº”ä¸€ä¸ªå”¯ä¸€çš„ Redis keyã€‚

### 2. **å°è¯•åŠ é”**
```java
if (lock.tryLock())
```
- åªæœ‰ç¬¬ä¸€ä¸ªçº¿ç¨‹æˆåŠŸè·å–åˆ°é”ï¼Œæ‰èƒ½æ‰§è¡Œæ³¨å†Œé€»è¾‘ï¼›
- å…¶ä»–çº¿ç¨‹ä¼šåœ¨æœªåŠ é”æ—¶ç›´æ¥è¿”å›â€œç”¨æˆ·åå·²å­˜åœ¨â€ã€‚

### 3. **æ‰§è¡Œä¸šåŠ¡é€»è¾‘**
æ’å…¥æ•°æ®åº“ç”¨æˆ·ä¿¡æ¯ï¼Œå¹¶é€šè¿‡å¸ƒéš†è¿‡æ»¤å™¨ç¼“å­˜ç”¨æˆ·åï¼Œé˜²æ­¢ç¼“å­˜ç©¿é€ã€‚

### 4. **é‡Šæ”¾é”**
```java
lock.unlock();
```
ç¡®ä¿æ— è®ºæ˜¯å¦å‘ç”Ÿå¼‚å¸¸ï¼Œæœ€ç»ˆéƒ½èƒ½é‡Šæ”¾é”ã€‚

## ä¸‰ã€ä¸ºä»€ä¹ˆè¦ç”¨åˆ†å¸ƒå¼é”ï¼Ÿ

å¦‚æœæ˜¯å•æœºéƒ¨ç½²ï¼Œç”¨ `synchronized` æˆ– `ReentrantLock` å°±å¤Ÿäº†ï¼›  
ä½†åœ¨ **å¤šå°æœåŠ¡èŠ‚ç‚¹éƒ¨ç½²çš„åˆ†å¸ƒå¼ç¯å¢ƒ** ä¸‹ï¼Œè¿™äº›é”æ˜¯**è¿›ç¨‹çº§åˆ«çš„**ï¼Œæ— æ³•è·¨èŠ‚ç‚¹å…±äº«ã€‚

Redis åˆ†å¸ƒå¼é”çš„å‡ºç°ï¼Œå°±æ˜¯ä¸ºäº†è§£å†³è¿™ç§è·¨èŠ‚ç‚¹çš„å¹¶å‘æ§åˆ¶é—®é¢˜ã€‚

## å››ã€åŸºäº Redis çš„åˆ†å¸ƒå¼é”åŸç†

1. **æ ¸å¿ƒå‘½ä»¤**ï¼š

   ```bash
   SET key value NX PX 30000
   ```

    - `NX`ï¼šä»…å½“ key ä¸å­˜åœ¨æ—¶æ‰è®¾ç½®ï¼ˆé˜²æ­¢é‡å¤ä¸Šé”ï¼‰
    - `PX 30000`ï¼šè®¾ç½®é”çš„è¿‡æœŸæ—¶é—´ï¼ˆé¿å…æ­»é”ï¼‰

2. **è§£é”é€»è¾‘**ï¼š

    - è§£é”å‰å…ˆåˆ¤æ–­é”æ˜¯å¦å±äºè‡ªå·±ï¼Œé˜²æ­¢è¯¯åˆ ä»–äººé”ã€‚

3. **Redisson å°è£…**
   Redisson åœ¨æ­¤åŸºç¡€ä¸Šæ‰©å±•äº†ï¼š

    - å¯é‡å…¥é”ï¼ˆReentrantLockï¼‰
    - çœ‹é—¨ç‹—æœºåˆ¶ï¼ˆè‡ªåŠ¨ç»­æœŸé”ï¼‰
    - å…¬å¹³é” / è¯»å†™é” ç­‰é«˜çº§ç‰¹æ€§

## äº”ã€ä¸ºä»€ä¹ˆé…åˆå¸ƒéš†è¿‡æ»¤å™¨ï¼Ÿ

å¸ƒéš†è¿‡æ»¤å™¨ï¼ˆBloom Filterï¼‰æ˜¯ç”¨äº**é˜²æ­¢ç¼“å­˜ç©¿é€**çš„ä¸€ç§æ•°æ®ç»“æ„ã€‚  
åœ¨æ³¨å†Œé€»è¾‘ä¸­ï¼š

- å…ˆé€šè¿‡å¸ƒéš†è¿‡æ»¤å™¨åˆ¤æ–­ç”¨æˆ·åæ˜¯å¦å­˜åœ¨ï¼›
- å†é€šè¿‡åˆ†å¸ƒå¼é”æ§åˆ¶æ³¨å†Œå¹¶å‘ã€‚

ä¸¤è€…ç»“åˆï¼Œæ—¢é˜²æ­¢é‡å¤æ³¨å†Œï¼Œåˆæå‡æ€§èƒ½ã€‚